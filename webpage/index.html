<!DOCTYPE html>
<html lang="en">

<head>
    <title>DFT_ESP32</title>


    <style>
        body {
            font-family: 'Trebuchet MS', sans-serif;
            padding: 5px 50px;
            /* position: fixed; */
        }

        .flex {
            display: flex;
            text-align: middle;
        }

        .font {
            font: "Arial", "san-serrif";
        }

        .SB {
            justify-content: space-between;
        }

        .indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: red;
            margin-right: 5px;
        }

        .bold {
            height: 2px;
            background-color: black;
            border-radius: 50%;
        }

        .tools {
            /* width: 350px; */
            border: 1px solid grey;
            padding: 5px;
        }

        .button {
            font-size: 18px;
            padding: 0px 10px;
            min-height: 35px;
            border: 1px solid grey;
            border-radius: 5px;
            margin: 8px;
        }

        .ROUTE_ON {
            color: white;
            background-color: #fa6400;
            border-color: #aa8c13;
        }

        .left {
            width: 200px;
            border: 1px solid grey;
            min-height: 33rem;
        }

        .right {
            padding: 4rem;
        }

        .display {
            border: 1px solid grey;
            width: 70vw;
            height: 55vh;
        }

        #myChart {

            height: 100% !important;
            width: 100% !important;
            color: white;
            /* display: none !important; */

        }

        .show {
            display: none !important;

        }
 
        .GPIOS {
            font-size: 17px;
            padding: 0px 18px;
            min-height: 42px;
            border: 1px solid grey;
            border-radius: 5px;
            margin: 8px;
        }

        .GPIO_ON {
            background-color: #12ca5f;
            border-color: #13aa52;
            color: white;
        }

        .GPIOs {
            position: inherit;
        }

        .WiFi {
            text-align: center;
            margin: auto;
            margin-top: 50px;
            padding: 5px;
            width: 200px;
            background-color: #f0f0f0;
            border: 1px solid grey;

        }

        .WiFi input {
            margin: 10px;
            padding: 5px;
        }

        .WiFi button {
            background-color: white;
            padding: 5px;
            border: 1px solid grey;
            border-radius: 4px;
        }

        .Custom {
            padding: .5rem;
        }

        .Custom textarea {
            min-width: 66rem;
            height: 22rem !important;
            margin-top: 1px;
        }

        .Reflash {
            display: block;
            width: 15rem;
            margin: auto;
            margin-top: 5rem;
            border: 1px solid grey;
            padding: 2rem;
            background-color: whitesmoke;
            border-radius: 2px;
        }

        #canvas {
            position: absolute;
            right: 0;
        }
        #osciCanvas {

height: 100% !important;
width: 100% !important;

}
        #dftCanvas {

height: 100% !important;
width: 100% !important;

}
    </style>
</head>

<body>
    <div class="flex SB">
        <div class="flex">
            <h1>Analysis : Embedded </h1>
            <p>esp32</p>
        </div>
        <div class="flex">
            <h3 class="indicator" id="indicator"></h3>
            <h3>Verson: </h3>
            <h4>0.15.0</h4>
        </div>
    </div>
    <hr class="bold">
    <div class="flex tools">
        <div>
            <button type="button" onclick="route(this)" id="system" class="button">System</button>
            <button type="button" onclick="route(this)" id="Introduction" class="button">Introduction</button>
            <button type="button" onclick="route(this)" id="Ossilloscope" class="button">Ossilloscope</button>
            <button type="button" onclick="route(this)" id="DFT" class="button">DFT</button>
            <button type="button" onclick="route(this)" id="Leds" class="button">Leds</button>
            <button type="button" onclick="route(this)" id="Notes" class="button">Notes</button>
            <button type="button" onclick="route(this)" id="Parameters" class="button">Parameters</button>
            <button type="button" onclick="route(this)" id="WiFi" class="button">WiFi Settings</button>
            <button type="button" onclick="route(this)" id="Custom" class="button">Custom Command</button>
            <button type="button" onclick="route(this)" id="GPIOs" class="button">GPIOs</button>
            <button type="button" onclick="route(this)" id="Reflash" class="button">System Reflash</button>
        </div>
    </div>
    <div class="flex">
        <div class="left">
            <h2>DFT</h2>

            <div class="Terminal">

            </div>
        </div>
        <div class="right">
            <div class="display">

                <div class="DFT show">
                    <table width="100%" border="1"><tr><td ><CANVAS id="dftCanvas"></CANVAS></td></tr></table>
                </div>

                <!--  -->
                <div class="Ossilloscope show">
                    <table width="100%" border="1"><tr><td ><CANVAS id="osciCanvas"></CANVAS></td></tr></table>
                    <div>
                        <canvas id="canvas"></canvas>
                    </div>
                </div>
                <!-- <canvas id="myChart" class="DFT show"></canvas> -->

                <!-- Custom command -->
                <div class="Custom show">
                    <div>
                        <input type="text">
                        <button type="button" onclick="CDM(this)">cmd</button>
                    </div>
                    <div>
                        <textarea name="cmd" id="" cols="" rows=""></textarea>
                    </div>
                </div>

                <!-- system reflash -->
                <center class="Reflash show">

                    <input type="file" name="file" id="">
                    <br><br>
                    <button type="button">Flash</button>

                </center>



                <div class="GPIOs show">
                    <div>
                        <button type="button" class="GPIOS" id="GPIO13" onclick="colorChange(this)">GPIO 13</button>
                        <button type="button" class="GPIOS" id="GPIO14" onclick="colorChange(this)">GPIO 14</button>
                        <button type="button" class="GPIOS" id="GPIO27" onclick="colorChange(this)">GPIO 27</button>
                        <button type="button" class="GPIOS" id="GPIO26" onclick="colorChange(this)">GPIO 26</button>
                        <button type="button" class="GPIOS" id="GPIO25" onclick="colorChange(this)">GPIO 25</button>
                        <button type="button" class="GPIOS" id="GPIO33" onclick="colorChange(this)">GPIO 33</button>
                        <button type="button" class="GPIOS" id="GPIO32" onclick="colorChange(this)">GPIO 32</button>
                        <button type="button" class="GPIOS" id="GPIO35" onclick="colorChange(this)">GPIO 35</button>
                        <button type="button" class="GPIOS" id="GPIO34" onclick="colorChange(this)">GPIO 34</button>
                    </div>
                    <div>
                        <button type="button" class="GPIOS" id="GPIO15" onclick="colorChange(this)">GPIO 15</button>
                        <button type="button" class="GPIOS" id="GPIO02" onclick="colorChange(this)">GPIO 02</button>
                        <button type="button" class="GPIOS" id="GPIO04" onclick="colorChange(this)">GPIO 04</button>
                        <button type="button" class="GPIOS" id="GPIO05" onclick="colorChange(this)">GPIO 05</button>
                        <button type="button" class="GPIOS" id="GPIO18" onclick="colorChange(this)">GPIO 18</button>
                        <button type="button" class="GPIOS" id="GPIO19" onclick="colorChange(this)">GPIO 19</button>
                        <button type="button" class="GPIOS" id="GPIO21" onclick="colorChange(this)">GPIO 21</button>
                        <button type="button" class="GPIOS" id="GPIO22" onclick="colorChange(this)">GPIO 22</button>
                        <button type="button" class="GPIOS" id="GPIO23" onclick="colorChange(this)">GPIO 23</button>
                    </div>
                </div>

                <div class="WiFi show">
                    <div class="WiFi_Card">
                        <h2>WiFi SSID || Password</h2>
                        <div>
                            <input type="text">
                        </div>
                        <div>
                            <input type="text">
                        </div>
                        <button type="button">Change</button>
                    </div>
                </div>




            </div>
        </div>
    </div>



    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.js"
        integrity="sha512-uLlukEfSLB7gWRBvzpDnLGvzNUluF19IDEdUoyGAtaO0MVSBsQ+g3qhLRL3GTVoEzKpc24rVT6X1Pr5fmsShBg=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <script>
        let DFT_button = false;

        function colorChange(e) {
            if (e.classList.toggle("GPIO_ON")) {
                websock.send(`${e.id} : ON_`);
            } else {
                websock.send(`${e.id} : OFF`);
            }
        }

        // route function for routing
        function route(e) {
            e.classList.toggle("ROUTE_ON")
            document.querySelector(`.${e.id}`).classList.toggle("show")
        }



        function DFT() {
            document.getElementById("myChart").classList.toggle("show");
        }





//         var canvas = document.getElementById("osciCanvas");
// var ctx = canvas.getContext("2d");
// let time=1;
// ctx.moveTo(-100, 0);
// // ctx.beginPath();
// ctx.lineTo(400, 100);
// ctx.stroke();

// function pushValueChart(data){
// ctx.moveTo(0, 0);
// ctx.lineTo(400, 100);
// ctx.stroke();
// if (time === 20){

// }
// }
    
    
const ctx = document.getElementById("osciCanvas").getContext('2d');
const myChart = new Chart(ctx, {
    type: 'line',
    data: {
        labels: [10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10],
        datasets: [{ 
            pointRadius: 0,
        label: 'Oscillscope',
        data: [10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10],
        backgroundColor: [
            'rgba(75, 192, 192,0.2)'
        ],
        borderColor: [
            'rgb(75, 192, 192)'
        ],
        // fill: true,
        borderWidth: 1,
        spanGaps:true,
        showLine:true,
        tension: 0.5
        }]
    },
    
    options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            y: {
                min:0,
                // max:600
            }

        },
        animation: {
        duration: 0
        }
    }
});

  
const bar = document.getElementById("dftCanvas").getContext('2d');
const myBar = new Chart(bar, {
    type: 'bar',
    data: {
        labels: [10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10],
        datasets: [{ 
            pointRadius: 0,
        label: 'Oscillscope',
        data: [10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10],
        backgroundColor: [
      'rgba(255, 99, 132, 0.2)',
      'rgba(255, 159, 64, 0.2)',
      'rgba(255, 205, 86, 0.2)',
      'rgba(75, 192, 192, 0.2)',
      'rgba(54, 162, 235, 0.2)',
      'rgba(153, 102, 255, 0.2)',
      'rgba(201, 203, 207, 0.2)'
    ],
    borderColor: [
      'rgb(255, 99, 132)',
      'rgb(255, 159, 64)',
      'rgb(255, 205, 86)',
      'rgb(75, 192, 192)',
      'rgb(54, 162, 235)',
      'rgb(153, 102, 255)',
      'rgb(201, 203, 207)'
    ],
        // fill: true,
        borderWidth: 1,
        spanGaps:true,
        showLine:true,
        tension: 0.5
        }]
    },
    
    options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            y: {
                min:0,
                // max:600
            }

        },
        animation: {
        duration: 0
        }
    }
});




function updateBar(data,position){
    if(position<=15){
        myBar.data.datasets[0].data[position]=data
        myBar.update();
    }
}



let time=0;
function pushValueChart(data){
let sameData;
    if(data != sameData ){

    myChart.data.datasets[0].data.push(data)
    myChart.data.datasets[0].data.shift()
    sameData=data;
    time+=1
    myChart.data.labels.push(time)
    myChart.data.labels.shift()
    myChart.update();
    }
    
}

    // setTimeout(() => {
        
    //     for (let inde = 0; inde < 5; inde++) {
    //         myChart.clear();
    //         for (let index = 0; index < 2; index++) {
    //         pushValueChart( Math.random() * (10 - 9) + 10)
    //     }
    //   }

    // }, 1000)





    </script>
    <script>
        // draw()
        // function draw() {
        //     const canvas = document.getElementById("canvas");
        //     if (canvas.getContext) {
        //         const ctx = canvas.getContext("2d");

        //         ctx.beginPath();
        //         ctx.arc(75, 75, 50, 0, Math.PI * 2, true); // Outer circle
        //         ctx.moveTo(110, 75);
        //         ctx.arc(75, 75, 35, 0, Math.PI, false); // Mouth (clockwise)
        //         ctx.moveTo(65, 65);
        //         ctx.arc(60, 65, 5, 0, Math.PI * 2, true); // Left eye
        //         ctx.moveTo(95, 65);
        //         ctx.arc(90, 65, 5, 0, Math.PI * 2, true); // Right eye
        //         ctx.stroke();
        //     }
        // }
    </script>
    <script>
        InitWebSocket()
        function InitWebSocket() {
            // websock = new WebSocket('ws://'+window.location.hostname+':81/'); 
            websock = new WebSocket('ws://192.168.43.108:81/');
            websock.onmessage = function (enent) {

                if (event.data = "Connected") {
                    // console.log(document.getElementById("indicator"))
                    document.getElementById("indicator").style.backgroundColor = "#55df55"
                }
                else if (event.data = "Disconnected") {
                    document.getElementById("indicator").style.backgroundColor = "red"
                }else{
                    
                }
                let websocket_data = event.data.split(" ")
                // console.log(websocket_data)

                // if(websocket_data[0]){

                // }


                switch (websocket_data[0]) {
                    case "oscilloscope":
                    pushValueChart(websocket_data[1])
                        break;
                    case "fft":
                    updateBar(websocket_data[1], websocket_data[2])
                        break;
                
                    default:
                        // console.log("hello");
                        break;
                }

                // pushValueChart(parseInt(event.data))
                    // console.log(event.data)
            }
        }

    </script>


</body>

</html>